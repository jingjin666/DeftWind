#!nsh

set USB autoconnect

#
# Try to mount the microSD card.
#
echo "[init] looking for microSD..."
if mount -t vfat /dev/mmcsd0 /fs/microsd
then
    echo "[init] card mounted at /fs/microsd"
    set HAVE_MICROSD 1
else
    echo "failed mount micro sdcard"
    set HAVE_MICROSD 0
fi

#
# Check for USB host
#
if [ $USB != autoconnect ]
then
    echo "[init] not connecting USB"
else
    if sercon
    then
        echo "[init] USB interface connected"
    else
        echo "[init] No USB connected"
    fi
fi

if [ $HAVE_MICROSD == 0 ]
then
    if usb_connected
    then
        echo "Opening USB nsh"
    else
        echo "booting with no microSD"
        set HAVE_MICROSD 1
    fi
fi

echo Starting DeftWind
if DeftWind start
then
    echo DeftWind started OK
else
    echo DeftWind started Failed
fi
